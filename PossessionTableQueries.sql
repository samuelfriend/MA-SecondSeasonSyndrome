--CREATING TABLE TO HOLD ALL POSSESSION STATS--
CREATE TABLE DataProjects.dbo.PossessionTable (
Team_Name varchar(100),
ChampPoss float,
DiffToCHPossAvg float,
FirstPLPoss float,
DiffToPL1PossAvg float,
SecondPLPoss float,
DiffToPL2PossAvg float)

--INSERTION QUERY USED FOR EACH SELECT QUERY--
--TO ADD DATA TO NEW TABLE--
INSERT INTO DataProjects.dbo.PossessionTable (Team_Name, ChampPoss, DiffToCHPossAvg, FirstPLPoss, DiffToPL1PossAvg, SecondPLPoss, DiffToPL2PossAvg)

--PRESENTING AVG POSS STATS FOR BRI + HUDD FROM THEIR--
--CH SEASON, 1ST PL and 2ND PL--
--INCLUDING THE LEAGUE AVERAGE EACH SEASON--
SELECT HB1617.Squad, 
HB1617.Poss AS CH_Poss, (HB1617.Poss - 50) AS DiffToAvg,
HB1718.Poss AS PL_First_Poss, (HB1718.Poss - 50) AS DiffToAvg2,
HB1819.Poss AS PL_Second_Poss, (HB1819.Poss - 50) AS DiffToAvg3
FROM DataProjects.dbo.HUDD_BRI_CH_STATS_1617 AS HB1617
INNER JOIN DataProjects.dbo.HUDD_BRI_PL_STATS_1718 AS HB1718 ON HB1617.Squad = HB1718.Squad
INNER JOIN DataProjects.dbo.HUDD_BRI_PL_STATS_1819 AS HB1819 ON HB1617.Squad = HB1819.Squad
WHERE HB1617.Squad = 'Brighton' 
	OR HB1617.Squad = 'Huddersfield'
GROUP BY HB1617.Squad, HB1617.Poss, HB1718.Poss, HB1819.Poss;


--PRESENTING AVG POSS STATS FOR LUFC FROM THEIR--
--CH SEASON, 1ST PL and 2ND PL--
--INCLUDING THE LEAGUE AVERAGE EACH SEASON--
SELECT LU1920.Squad,
LU1920.Poss AS CH_Poss, (LU1920.Poss - 50) AS CHDiff,
LU2021.Poss AS First_Poss, (LU2021.Poss - 50) AS PL1Diff,
LU2122.Poss AS Second_Poss, (LU2122.Poss - 50) AS PL2Diff
FROM DataProjects.dbo.LUFC_CH_STATS_1920$ AS LU1920
INNER JOIN DataProjects.dbo.LUFC_PL_STATS_2021$ AS LU2021 ON LU1920.Squad = LU2021.Squad
INNER JOIN DataProjects.dbo.LUFC_PL_STATS_2122$ AS LU2122 ON LU1920.Squad = LU2122.Squad
WHERE LU1920.Squad = 'Leeds United'
GROUP BY LU1920.Squad, LU1920.Poss, LU2021.Poss, LU2122.Poss


--PRESENTING AVG POSS STATS FOR SUFC FROM THEIR--
--CH SEASON, 1ST PL and 2ND PL--
--INCLUDING THE LEAGUE AVERAGE EACH SEASON--
SELECT SU1819.Squad,
SU1819.Poss AS CH_Poss, (SU1819.Poss - 50) AS CHDiff,
SU1920.Poss AS First_Poss, (SU1920.Poss - 50) AS PL1Diff,
SU2021.Poss AS Second_Poss, (SU2021.Poss - 50) AS PL2Diff
FROM DataProjects.dbo.SUFC_CH_STATS_1819$ AS SU1819
INNER JOIN DataProjects.dbo.SUFC_PL_STATS_1920$ AS SU1920 ON SU1819.Squad = SU1920.Squad
INNER JOIN DataProjects.dbo.SUFC_PL_STATS_2021$ AS SU2021 ON SU1819.Squad = SU2021.Squad
WHERE SU1819.Squad = 'Sheffield Utd'
GROUP BY SU1819.Squad, SU1819.Poss, SU1920.Poss, SU2021.Poss


--PREVIEWING CORRECT OUTPUT--
SELECT * FROM DataProjects.dbo.PossessionTable ORDER BY Team_Name ASC;
